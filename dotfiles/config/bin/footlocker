#!/usr/bin/bash

dependencies="i3lock scrot convert"

check_integrity() {
    for requirement in ${dependencies} ; do
        command -v ${requirement} >/dev/null 2>&1 || {
            echo "[ERROR] missing ${requirement}" >&2;
        exit 1; }

    done
}

lock() {
    letterEnteredColor=98971aff
    letterRemovedColor=fabd2fff
    passwordCorrect=00000000
    passwordIncorrect=fb4934ff
    background=00000000
    foreground=ffffffff
    tmp_bg_f='/tmp/i3lock/'
    tmp_bg='lock.png'
    l_img="${tmp_bg_f}${tmp_bg}"

    if [ ! -d $tmp_bg_f ];then
        mkdir -p "${tmp_bg_f}"
    fi
    if [ -z $AUTOBG ]; then
        scrot -z "${l_img}"
    else
        cp -f $AUTOBG $l_img
    fi

    if [ -z $BLUR ]; then
        BLUR="0x5"
    fi

    convert "${l_img}" -blur $BLUR -fill black -colorize 15% "${l_img}"
    i3lock -tb -i "${l_img}"
}

helpmenu() {
    echo "footlocker [param [options]] \n
    -t | --text <text>          : displayed text \n
    -b | --blur <0xN>           : blur effect, N is an int \n
    -p | --picture <path>       : give picture to display"
}

check_integrity

while [ ! $# -eq 0 ]
do
    case "$1" in
        --picture | -p)
            AUTOBG=$2
            ;;
        --blur | -b)
            BLUR=$2
            ;;
        --help)
            helpmenu
            exit
            ;;
    esac
    shift
done
lock
